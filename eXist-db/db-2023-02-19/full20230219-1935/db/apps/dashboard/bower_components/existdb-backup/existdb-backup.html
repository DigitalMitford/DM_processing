<html><head></head><body><dom-module id="existdb-backup"><template><style>:host{display:block;@apply (--paper-font-common-base);display:block;padding:0;margin:0;width:100%;height:100%;}.x{--iron-icon-fill-color:white;margin-right:10px;--iron-icon-width:30px;--iron-icon-height:30px;}paper-checkbox{display:block;padding:10px 0;}paper-button{margin:10px 0;}caption, th{text-align:left;}caption{font-size:larger;font-weight:500;padding:10px;background:var(--paper-blue-700);color:white;}th{padding:10px;color:var(--paper-blue-700);}tr{background:white;}td{padding:10px;}td:nth-child(3), td:nth-child(4){text-align:center;}paper-icon-button{color:var(--paper-blue-500);}paper-icon-button.disabled{color:var(--paper-grey-500);}paper-card{width:max-content;margin:50px;display:table;--paper-card-header:{background:var(--paper-blue-700);};--paper-card-header-text:{color:white;};}h3{width:100%;text-align:center;color:var(--paper-grey-700);}[icon='error-outline']{margin-right:6px;color:var(--paper-orange-500);}paper-dialog{background:transparent;border:none;box-shadow:none;}paper-spinner{width:50px;height:50px;}iron-overlay-backdrop{background:var(--paper-grey-100);}a.downloadLink{padding:0;margin:0;}.wrapper{padding-bottom:50px;}</style><paper-dialog id="backdrop" modal=""><paper-spinner active=""></paper-spinner></paper-dialog><iron-ajax id="loadBackups" verbose="" with-credentials="" method="get" handle-as="json" on-response="_handleResponse" on-error="_handleError"></iron-ajax><iron-ajax id="triggerBackup" verbose="" with-credentials="" method="post" handle-as="json" on-response="_handleBackupResponse"></iron-ajax><div class="wrapper"><paper-card heading="Backups"><div class="card-actions"><iron-form id="backupForm"><form method="post"><paper-checkbox name="zip">zip (Don't use for database with more than 4gb)</paper-checkbox><paper-checkbox name="inc">incremental</paper-checkbox><paper-button raised="" on-tap="_trigger">trigger backup</paper-button></form></iron-form><h3><iron-icon icon="error-outline"></iron-icon>For security reasons only zipped backups can be downloaded</h3></div><div class="card-content"><table><thead><tr><th>Name</th><th>Created</th><th>Incremental</th><th></th></tr></thead><template id="backupList" is="dom-repeat" items="{{backups}}" as="item"><tr><td>[[item.name]]</td><td>[[item.created]]</td><td>[[item.incremental]]</td><td><template is="dom-if" if="[[_isDownloadable(item.name)]]"><a class="downloadLink" href="{{_getHref(item.name)}}" tabindex="-1" target="_blank"><paper-icon-button icon="file-download"></paper-icon-button></a></template><template is="dom-if" if="[[_isDisabled(item.name)]]"><paper-icon-button class="disabled" icon="file-download" disabled=""></paper-icon-button></template></td></tr></template></table></div></paper-card></div></template><script>/**
         * `existdb-backup`
         * a UI for backup
         *
         * @customElement
         * @polymer
         * @demo demo/index.html
         */class ExistdbBackup extends Polymer.Element{static get is(){return"existdb-backup"}static get properties(){return{backups:{type:Array,value:[],notify:!0/* ignoreName */ /* skipSlots */},path:{type:String,computed:"_getHref(this.backups)"}}}connectedCallback(){super.connectedCallback();this.$.loadBackups.url=this.importPath+"modules/backup.xql";this.$.loadBackups.generateRequest()}_handleResponse(){this.backups=this.$.loadBackups.lastResponse;console.log("response ",this.backups)}_getHref(name){console.log("name ",name);return this.importPath+"modules/backup.xql?action=retrieve&archive="+name}_isDownloadable(name){return name.endsWith(".zip")}_isDisabled(name){return!name.endsWith(".zip")}_trigger(e){this.$.triggerBackup.url=this.importPath+"modules/backup.xql?action=trigger";console.log("params ",this.$.backupForm.serializeForm());this.$.triggerBackup.params=this.$.backupForm.serializeForm();this.$.triggerBackup.generateRequest();this.$.backdrop.open()}_handleBackupResponse(){console.log("backup response ",this.$.triggerBackup.lastResponse);this.$.backdrop.close();this.$.loadBackups.generateRequest()}_showLogout(){//                console.log('showLogout ', this.logout);
return"true"==this.getAttribute("logout")}_handleError(){console.log("An error occurred: ",this.$.loadBackups.lastError)}}window.customElements.define(ExistdbBackup.is,ExistdbBackup);</script></dom-module></body></html>