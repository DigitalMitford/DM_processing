<html><head></head><body><dom-module id="existdb-login"><template><style>:host{display:block;}paper-dialog{min-width:320px;max-width:640px;min-height:128px;}paper-dialog h2{background-color:#2196f3;padding:16px 8px;margin-top:0;color:#F0F0F0;@apply --existdb-login-title;}a, a:link{text-decoration:none;@apply --existdb-login-theme;}@media (max-width: 1024px){.label{display:none;}}#message{color:var(--paper-red-800);}</style><a href="#" on-click="_show" title="[[user]]"><template is="dom-if" if="[[loggedIn]]"><template is="dom-if" if="[[logoutIcon]]"><iron-icon icon="[[logoutIcon]]"></iron-icon></template><span class="label">[[logoutLabel]] [[user]]</span></template><template is="dom-if" if="[[!loggedIn]]"><template is="dom-if" if="[[loginIcon]]"><iron-icon icon="[[loginIcon]]"></iron-icon></template><span class="label">[[loginLabel]]</span></template></a><paper-dialog id="loginDialog"><h2>Login</h2><paper-dialog-scrollable><form action="login"><paper-input name="user" label="User" value="{{user}}" on-keyup="_submitDialog" autofocus=""></paper-input><paper-input name="password" label="Password" type="password" value="{{password}}" on-keyup="_submitDialog"></paper-input><input id="logout" type="hidden" name="logout"></form><template is="dom-if" if="[[_invalid]]"><p id="message">Wrong password or invalid user<template is="dom-if" if="[[group]]">(must be member of group [[group]])</template></p></template></paper-dialog-scrollable><div class="buttons"><paper-button autofocus="" on-click="_confirmLogin">Login</paper-button></div></paper-dialog><iron-ajax id="checkLogin" url="/exist/apps/dashboard/login" handle-as="json" on-response="_handleResponse" content-type="application/x-www-form-urlencoded" method="POST"></iron-ajax></template><script>/**
         * Handles login/logout. Shows a link which opens a login dialog if clicked.
         * If a user is logged in, clicking the link will log him out instead.
         *
         * @customElement
         * @polymer
         * @appliesMixin PbMixin
         */class ExistdbLogin extends Polymer.Element{static get is(){return"existdb-login"}static get properties(){return{/** True if user is currently logged in */loggedIn:{type:Boolean,value:!1},/**
                     * The currently logged in user.
                     */user:{type:String},/**
                     * If set, only users being members of the specified group are
                     * allowed to log in.
                     */group:{type:String},/**
                     * Array of groups the current user is a member of.
                     */groups:{type:Array,value:[]},/**
                     * If set to true, automatically show login dialog if user is not logged in
                     */auto:{type:Boolean,value:!1},/**
                     * Label to show if not logged in
                     */loginLabel:{type:String},/**
                     * Label to show before user name if logged in
                     */logoutLabel:{type:String},loginIcon:{type:String,value:"account-circle"},logoutIcon:{type:String,value:"supervisor-account"},password:{type:String},loginUrl:{type:String},logoutUrl:{type:String},_invalid:{type:Boolean},_hasFocus:{type:Boolean,value:!0}}}connectedCallback(){super.connectedCallback();window.addEventListener("blur",()=>{this._hasFocus=!1});window.addEventListener("focus",()=>{if(!this._hasFocus){this._hasFocus=!0;this.$.checkLogin.body=null;this.$.checkLogin.generateRequest()}});document.addEventListener("checkUser",ev=>{console.log("checkUser event received: %o",ev.detail);if(ev.detail.user===this.user){this.password=ev.detail.password;this._confirmLogin()}})}ready(){super.ready();Polymer.RenderStatus.afterNextRender(this,()=>{this.$.checkLogin.body=null;this.$.checkLogin.generateRequest()})}_show(ev){ev.preventDefault();if(this.loggedIn){this.$.checkLogin.body={logout:this.user};this.$.checkLogin.generateRequest()}else{this.$.loginDialog.open()}}_confirmLogin(){this.$.checkLogin.body={user:this.user,password:this.password};this.$.checkLogin.generateRequest()}_handleResponse(){const wasLoggedIn=this.loggedIn,resp=this.$.checkLogin.lastResponse;if(resp.user&&this._checkGroup(resp)){this.loggedIn=!0;this.user=resp.user;this.groups=resp.groups;this._invalid=!1;if(!wasLoggedIn&&this.loginUrl){window.location=this.loginUrl}this.$.loginDialog.close()}else{this.loggedIn=!1;this.password=null;if(this.$.loginDialog.opened){this._invalid=!0}else if(this.auto){this.$.loginDialog.open()}else if(wasLoggedIn&&this.logoutUrl){console.log("redirecting to %s",this.logoutUrl);window.location=this.logoutUrl}}}_checkGroup(info){if(this.group){return info.groups&&-1<info.groups.indexOf(this.group)}return!0}_submitDialog(ev){if(13===ev.keyCode){this._confirmLogin()}}/**
             * Fired on successful login.
             *
             * @event pb-login
             * @param {String} user logged in user
             * @param {Array<String>} groups groups the user is a member of
             */}window.customElements.define(ExistdbLogin.is,ExistdbLogin);</script></dom-module></body></html>